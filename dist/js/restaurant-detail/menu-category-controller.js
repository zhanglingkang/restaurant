/*! ppz_website 2015-01-12 6:55:00 PM */
"use strict";define(function(a){var b=a("app");a("./menu-service"),b.controller("menuCategoryController",["$scope","menuService",function(a,b){a.addingNewItem=!1,a.editing=!1,a.nameModified=a.category.categoryName,a.descriptionModified=a.category.categoryDescription,a.editCategory=function(){a.editing=!0,a.editStatus=a.REQUEST_STATUS.INIT},a.confirmEditCategory=function(){a.editStatus=a.REQUEST_STATUS.REQUESTING,b.modifyMenuCategory({categoryName:a.nameModified,categoryDescription:a.descriptionModified,categoryId:a.category.categoryId},a.menu.restaurantId).then(function(){a.editStatus=a.REQUEST_STATUS.REQUEST_SUCCESSED,a.category.categoryName=a.nameModified,a.category.categoryDescription=a.descriptionModified,a.editing=!1},function(){a.editStatus=a.REQUEST_STATUS.REQUEST_FAILED})},a.sortMenuItem=function(c){var d=null,e=c.sortList;a.setAlert({showCover:!0,alertContent:"排序中..."}),e.forEach(function(a,b){a.id===c.dragNodeId&&b>0&&(d=c.sortList[b-1].id)}),b.sortMenuItem({itemId:c.dragNodeId,previousItemId:d,categoryId:a.category.categoryId},a.menu.restaurantId).then(function(){var b=[];e.forEach(function(c){b.push(a.getMenuItem(c.id))}),a.category.items=b,a.setAlert({showCover:!1})})},a.getMenuItem=function(b){var c;return a.category.items.some(function(a){return a.itemId===b?(c=a,!0):void 0}),c},a.deleteStatus=a.REQUEST_STATUS.INIT,a.removeMenuCategory=function(){a.deleteStatus=a.REQUEST_STATUS.REQUESTING,b.removeMenuCategory(a.category.categoryId,a.menu.restaurantId).then(function(){a.editStatus=a.REQUEST_STATUS.REQUEST_SUCCESSED,a.menu.menuCategories=a.menu.menuCategories.filter(function(b){return b.categoryId!==a.category.categoryId})},function(){a.editStatus=a.REQUEST_STATUS.REQUEST_FAILED})},a.$on("collapse",function(b,c){a.collapse=c}),a.cancelEditCategory=function(){a.nameModified=a.category.categoryName,a.descriptionModified=a.category.categoryDescription,a.categoryEditForm.$setPristine(),a.editing=!1},a.addNewItem=function(){a.addingNewItem||(a.addingNewItem=!0,a.addMenuItemStatus=a.REQUEST_STATUS.INIT,a.menuItemForm={},a.menuItemFormValidation.$setPristine())},a.confirmAddItem=function(c){c&&(a.addMenuItemStatus=a.REQUEST_STATUS.REQUESTING,b.addMenuItem(angular.extend(a.menuItemForm,{categoryId:a.category.categoryId}),a.menu.restaurantId).then(function(b){a.addMenuItemStatus=a.REQUEST_STATUS.REQUEST_SUCCESSED,a.category.items=a.category.items.concat(b.results),a.addingNewItem=!1},function(){a.addMenuItemStatus=a.REQUEST_STATUS.REQUEST_FAILED}))},a.cancelAddItem=function(){a.addingNewItem=!1},a.toggleMenuCategory=function(a){$("#"+a).collapse("toggle")}}])});